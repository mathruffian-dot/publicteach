<div class="fixed inset-0 bg-black/70 z-40 flex items-center justify-center p-4" (click)="closeModal.emit()">
  <div class="bg-slate-900 border-2 border-amber-500/50 rounded-lg shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col" (click)="$event.stopPropagation()">
    <!-- Modal Header -->
    <div class="p-6 border-b-2 klimt-border">
      <h2 class="text-2xl font-bold text-amber-400">觀課總結報告</h2>
      <p class="text-slate-400">科目: {{ subject() }} | 總時長: {{ totalTime() }}</p>
    </div>

    <!-- Modal Content -->
    <div class="p-6 overflow-y-auto space-y-6">
      <!-- Teaching States -->
      <div>
        <h3 class="text-lg font-semibold text-amber-500 mb-2">教學模式</h3>
        <ul class="list-disc list-inside space-y-1 text-slate-300">
          @for (state of states(); track state.name) {
            <li>{{ state.name }}: <span class="font-mono">{{ formatTime(state.time) }}</span></li>
          }
        </ul>
      </div>

      <!-- Teaching Actions -->
      <div>
        <h3 class="text-lg font-semibold text-amber-500 mb-2">教學行為</h3>
        <ul class="list-disc list-inside space-y-1 text-slate-300">
          @for (action of actions(); track action.name) {
            <li>{{ action.name }}: <span class="font-mono">{{ action.count }} 次</span></li>
          }
        </ul>
      </div>

      <!-- Engagement Log -->
      <div>
        <h3 class="text-lg font-semibold text-amber-500 mb-2">學生專注度</h3>
        <ul class="list-disc list-inside space-y-1 text-slate-300">
          @for (log of engagementLog(); track $index) {
            <li>[{{ log.time }}] <span class="font-mono">{{ log.level }}</span></li>
          }
          @if(engagementLog().length === 0) {
            <li class="list-none text-slate-500">無專注度紀錄</li>
          }
        </ul>
      </div>
      
      <!-- Qualitative Notes -->
      <div>
        <h3 class="text-lg font-semibold text-amber-500 mb-2">質性紀錄</h3>
        <ul class="list-disc list-inside space-y-1 text-slate-300">
          @for (note of qualitativeNotes(); track $index) {
            <li>{{ note }}</li>
          }
          @if(qualitativeNotes().length === 0) {
            <li class="list-none text-slate-500">無質性紀錄</li>
          }
        </ul>
      </div>
    </div>

    <!-- Modal Footer -->
    <div class="p-6 border-t-2 border-slate-700/50 flex justify-end items-center space-x-4">
      <button (click)="copyReport()" class="px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded-md transition">複製紀錄</button>
      <button (click)="downloadReport()" class="px-4 py-2 bg-amber-500 hover:bg-amber-600 text-slate-900 rounded-md font-semibold transition">下載 TXT</button>
      <button (click)="closeModal.emit()" class="px-4 py-2 bg-red-800 hover:bg-red-700 rounded-md transition">關閉</button>
    </div>
  </div>
</div>
